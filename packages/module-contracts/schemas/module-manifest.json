{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://schemas.plataforma.app/module-manifest/1.0.0",
  "title": "Module Manifest",
  "description": "Schema for plataforma.app module manifests",
  "type": "object",
  "required": [
    "id",
    "name",
    "version",
    "description",
    "category",
    "type",
    "author",
    "license",
    "keywords",
    "entryPoints",
    "dependencies",
    "requirements",
    "permissions",
    "metadata"
  ],
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^[a-z][a-z0-9-]*[a-z0-9]$",
      "description": "Unique module identifier in kebab-case"
    },
    "name": {
      "type": "string",
      "minLength": 1,
      "maxLength": 100,
      "description": "Human-readable module name"
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+(-[\\w\\d-]+)?(\\+[\\w\\d-]+)?$",
      "description": "Semantic version following semver specification"
    },
    "description": {
      "type": "string",
      "minLength": 10,
      "maxLength": 500,
      "description": "Brief description of module functionality"
    },
    "category": {
      "type": "string",
      "enum": [
        "business",
        "system",
        "ai",
        "communication",
        "storage",
        "security",
        "analytics",
        "integration",
        "utility",
        "custom"
      ],
      "description": "Module category for organization and discovery"
    },
    "type": {
      "type": "string",
      "enum": [
        "business-module",
        "system-module",
        "plugin",
        "ui-library",
        "service",
        "data-provider",
        "middleware"
      ],
      "description": "Module type determines integration patterns"
    },
    "author": {
      "oneOf": [
        {
          "type": "string",
          "description": "Author name"
        },
        {
          "type": "object",
          "required": ["name"],
          "properties": {
            "name": {
              "type": "string",
              "description": "Author name"
            },
            "email": {
              "type": "string",
              "format": "email",
              "description": "Author email"
            },
            "url": {
              "type": "string",
              "format": "uri",
              "description": "Author website"
            },
            "organization": {
              "type": "string",
              "description": "Author organization"
            }
          },
          "additionalProperties": false
        }
      ],
      "description": "Author information"
    },
    "license": {
      "type": "string",
      "description": "License identifier (SPDX format preferred)"
    },
    "homepage": {
      "type": "string",
      "format": "uri",
      "description": "Homepage or documentation URL"
    },
    "repository": {
      "type": "object",
      "required": ["type", "url"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["git", "svn", "mercurial"]
        },
        "url": {
          "type": "string",
          "format": "uri"
        },
        "directory": {
          "type": "string",
          "description": "Directory within repository"
        }
      },
      "additionalProperties": false,
      "description": "Source repository information"
    },
    "keywords": {
      "type": "array",
      "items": {
        "type": "string",
        "minLength": 1,
        "maxLength": 50
      },
      "maxItems": 20,
      "uniqueItems": true,
      "description": "Keywords for search and discovery"
    },
    "entryPoints": {
      "type": "object",
      "required": ["main"],
      "properties": {
        "main": {
          "type": "string",
          "description": "Main entry point for the module"
        },
        "types": {
          "type": "string",
          "description": "TypeScript type definitions"
        },
        "browser": {
          "type": "string",
          "description": "Browser-specific entry point"
        },
        "node": {
          "type": "string",
          "description": "Node.js-specific entry point"
        },
        "react": {
          "type": "string",
          "description": "React component entry point"
        },
        "server": {
          "type": "string",
          "description": "Server-side entry point"
        },
        "exports": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Additional named exports"
        }
      },
      "additionalProperties": false,
      "description": "Module entry points and exports"
    },
    "dependencies": {
      "type": "object",
      "required": ["platform", "peers", "optionalPeers", "external"],
      "properties": {
        "platform": {
          "type": "string",
          "pattern": "^[~^]?\\d+\\.\\d+\\.\\d+",
          "description": "Required platform core version"
        },
        "peers": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/peerDependency"
          },
          "description": "Required peer modules"
        },
        "optionalPeers": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/peerDependency"
          },
          "description": "Optional peer modules"
        },
        "external": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/externalDependency"
          },
          "description": "External npm dependencies"
        }
      },
      "additionalProperties": false,
      "description": "Module dependencies"
    },
    "requirements": {
      "type": "object",
      "properties": {
        "node": {
          "type": "string",
          "pattern": "^>=?\\d+\\.\\d+\\.\\d+",
          "description": "Minimum Node.js version"
        },
        "browser": {
          "$ref": "#/definitions/browserRequirements"
        },
        "memory": {
          "type": "integer",
          "minimum": 1,
          "description": "Memory requirements in MB"
        },
        "storage": {
          "type": "integer",
          "minimum": 1,
          "description": "Storage requirements in MB"
        },
        "network": {
          "$ref": "#/definitions/networkRequirements"
        },
        "database": {
          "$ref": "#/definitions/databaseRequirements"
        }
      },
      "additionalProperties": false,
      "description": "Runtime requirements"
    },
    "permissions": {
      "type": "object",
      "required": ["system", "resources", "api", "ui"],
      "properties": {
        "system": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "filesystem:read",
              "filesystem:write",
              "network:access",
              "database:read",
              "database:write",
              "system:config",
              "user:data",
              "notifications:send",
              "tasks:background"
            ]
          },
          "uniqueItems": true,
          "description": "Required system permissions"
        },
        "resources": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/resourcePermission"
          },
          "description": "Required resource permissions"
        },
        "api": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/apiPermission"
          },
          "description": "API access permissions"
        },
        "ui": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/uiPermission"
          },
          "description": "UI integration permissions"
        }
      },
      "additionalProperties": false,
      "description": "Permission specifications"
    },
    "configSchema": {
      "$ref": "#/definitions/jsonSchema",
      "description": "Configuration schema"
    },
    "ui": {
      "$ref": "#/definitions/uiSpec",
      "description": "UI integration specifications"
    },
    "api": {
      "$ref": "#/definitions/apiSpec",
      "description": "API specifications"
    },
    "lifecycle": {
      "$ref": "#/definitions/lifecycleConfig",
      "description": "Lifecycle hooks configuration"
    },
    "metadata": {
      "type": "object",
      "required": ["createdAt", "modifiedAt"],
      "properties": {
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "Creation timestamp"
        },
        "modifiedAt": {
          "type": "string",
          "format": "date-time",
          "description": "Last modified timestamp"
        },
        "build": {
          "$ref": "#/definitions/buildInfo"
        },
        "certification": {
          "$ref": "#/definitions/certification"
        },
        "analytics": {
          "type": "boolean",
          "description": "Usage analytics opt-in"
        },
        "telemetry": {
          "$ref": "#/definitions/telemetryConfig"
        },
        "documentation": {
          "$ref": "#/definitions/documentation"
        }
      },
      "additionalProperties": false,
      "description": "Module metadata"
    }
  },
  "additionalProperties": false,
  "definitions": {
    "peerDependency": {
      "type": "object",
      "required": ["moduleId", "versionRange"],
      "properties": {
        "moduleId": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9-]*[a-z0-9]$"
        },
        "versionRange": {
          "type": "string",
          "pattern": "^[~^*]?\\d+\\.\\d+\\.\\d+"
        },
        "optional": {
          "type": "boolean",
          "default": false
        }
      },
      "additionalProperties": false
    },
    "externalDependency": {
      "type": "object",
      "required": ["name", "versionRange"],
      "properties": {
        "name": {
          "type": "string",
          "minLength": 1
        },
        "versionRange": {
          "type": "string"
        },
        "dev": {
          "type": "boolean",
          "default": false
        }
      },
      "additionalProperties": false
    },
    "browserRequirements": {
      "type": "object",
      "required": ["features"],
      "properties": {
        "features": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "minimumVersions": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        }
      },
      "additionalProperties": false
    },
    "networkRequirements": {
      "type": "object",
      "required": ["required"],
      "properties": {
        "required": {
          "type": "boolean"
        },
        "domains": {
          "type": "array",
          "items": {
            "type": "string",
            "format": "hostname"
          }
        },
        "protocols": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["http", "https", "ws", "wss"]
          }
        }
      },
      "additionalProperties": false
    },
    "databaseRequirements": {
      "type": "object",
      "required": ["required"],
      "properties": {
        "required": {
          "type": "boolean"
        },
        "schemas": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "tables": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/tableRequirement"
          }
        },
        "functions": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": false
    },
    "tableRequirement": {
      "type": "object",
      "required": ["name", "permissions"],
      "properties": {
        "name": {
          "type": "string"
        },
        "schema": {
          "type": "string"
        },
        "permissions": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["SELECT", "INSERT", "UPDATE", "DELETE"]
          }
        }
      },
      "additionalProperties": false
    },
    "resourcePermission": {
      "type": "object",
      "required": ["resource", "actions"],
      "properties": {
        "resource": {
          "type": "string"
        },
        "actions": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "scope": {
          "type": "string",
          "enum": ["global", "module", "user"]
        }
      },
      "additionalProperties": false
    },
    "apiPermission": {
      "type": "object",
      "required": ["endpoint", "methods"],
      "properties": {
        "endpoint": {
          "type": "string"
        },
        "methods": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["GET", "POST", "PUT", "DELETE", "PATCH"]
          }
        },
        "rateLimit": {
          "type": "integer",
          "minimum": 1
        }
      },
      "additionalProperties": false
    },
    "uiPermission": {
      "type": "object",
      "required": ["area"],
      "properties": {
        "area": {
          "type": "string",
          "enum": ["desktop", "taskbar", "sidebar", "modal", "fullscreen"]
        },
        "priority": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100
        }
      },
      "additionalProperties": false
    },
    "jsonSchema": {
      "type": "object",
      "required": ["type", "properties"],
      "properties": {
        "type": {
          "type": "string",
          "const": "object"
        },
        "properties": {
          "type": "object",
          "additionalProperties": true
        },
        "required": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "additionalProperties": {
          "type": "boolean"
        }
      },
      "additionalProperties": false
    },
    "uiSpec": {
      "type": "object",
      "required": ["windows"],
      "properties": {
        "windows": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/windowSpec"
          }
        },
        "sidebars": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/sidebarSpec"
          }
        },
        "taskbar": {
          "$ref": "#/definitions/taskbarSpec"
        },
        "contextMenus": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/contextMenuSpec"
          }
        },
        "themes": {
          "$ref": "#/definitions/themeSpec"
        }
      },
      "additionalProperties": false
    },
    "windowSpec": {
      "type": "object",
      "required": ["id", "title", "icon", "defaultSize"],
      "properties": {
        "id": {
          "type": "string"
        },
        "title": {
          "type": "string"
        },
        "icon": {
          "type": "string"
        },
        "defaultSize": {
          "$ref": "#/definitions/size"
        },
        "minSize": {
          "$ref": "#/definitions/size"
        },
        "maxSize": {
          "$ref": "#/definitions/size"
        },
        "resizable": {
          "type": "boolean",
          "default": true
        },
        "modal": {
          "type": "boolean",
          "default": false
        },
        "singleton": {
          "type": "boolean",
          "default": false
        }
      },
      "additionalProperties": false
    },
    "sidebarSpec": {
      "type": "object",
      "required": ["id", "title", "icon", "position"],
      "properties": {
        "id": {
          "type": "string"
        },
        "title": {
          "type": "string"
        },
        "icon": {
          "type": "string"
        },
        "position": {
          "type": "string",
          "enum": ["left", "right"]
        },
        "width": {
          "type": "integer",
          "minimum": 100
        },
        "collapsible": {
          "type": "boolean",
          "default": true
        }
      },
      "additionalProperties": false
    },
    "taskbarSpec": {
      "type": "object",
      "required": ["icon", "tooltip"],
      "properties": {
        "icon": {
          "type": "string"
        },
        "tooltip": {
          "type": "string"
        },
        "priority": {
          "type": "integer",
          "minimum": 0
        },
        "showBadge": {
          "type": "boolean",
          "default": false
        }
      },
      "additionalProperties": false
    },
    "contextMenuSpec": {
      "type": "object",
      "required": ["id", "label", "context", "action"],
      "properties": {
        "id": {
          "type": "string"
        },
        "label": {
          "type": "string"
        },
        "context": {
          "type": "string",
          "enum": ["file", "folder", "text", "global"]
        },
        "action": {
          "type": "string"
        },
        "icon": {
          "type": "string"
        },
        "shortcut": {
          "type": "string"
        }
      },
      "additionalProperties": false
    },
    "themeSpec": {
      "type": "object",
      "required": ["supports"],
      "properties": {
        "supports": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["light", "dark", "auto"]
          }
        },
        "customThemes": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": false
    },
    "apiSpec": {
      "type": "object",
      "properties": {
        "rest": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/restEndpoint"
          }
        },
        "graphql": {
          "$ref": "#/definitions/graphqlSpec"
        },
        "events": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/eventSpec"
          }
        },
        "rpc": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/rpcSpec"
          }
        }
      },
      "additionalProperties": false
    },
    "restEndpoint": {
      "type": "object",
      "required": ["path", "method", "description", "responses"],
      "properties": {
        "path": {
          "type": "string"
        },
        "method": {
          "type": "string",
          "enum": ["GET", "POST", "PUT", "DELETE", "PATCH"]
        },
        "description": {
          "type": "string"
        },
        "parameters": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/apiParameter"
          }
        },
        "responses": {
          "type": "object",
          "additionalProperties": {
            "$ref": "#/definitions/apiResponse"
          }
        },
        "authentication": {
          "type": "boolean",
          "default": false
        },
        "rateLimit": {
          "type": "integer",
          "minimum": 1
        }
      },
      "additionalProperties": false
    },
    "graphqlSpec": {
      "type": "object",
      "required": ["schema"],
      "properties": {
        "schema": {
          "type": "string"
        },
        "resolvers": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": false
    },
    "eventSpec": {
      "type": "object",
      "required": ["name", "description", "schema"],
      "properties": {
        "name": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "schema": {
          "$ref": "#/definitions/jsonSchema"
        }
      },
      "additionalProperties": false
    },
    "rpcSpec": {
      "type": "object",
      "required": ["name", "description", "parameters", "returns"],
      "properties": {
        "name": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "parameters": {
          "$ref": "#/definitions/jsonSchema"
        },
        "returns": {
          "$ref": "#/definitions/jsonSchema"
        }
      },
      "additionalProperties": false
    },
    "apiParameter": {
      "type": "object",
      "required": ["name", "type", "required", "description"],
      "properties": {
        "name": {
          "type": "string"
        },
        "type": {
          "type": "string",
          "enum": ["string", "number", "boolean", "object", "array"]
        },
        "required": {
          "type": "boolean"
        },
        "description": {
          "type": "string"
        },
        "schema": {
          "$ref": "#/definitions/jsonSchema"
        }
      },
      "additionalProperties": false
    },
    "apiResponse": {
      "type": "object",
      "required": ["description", "schema"],
      "properties": {
        "description": {
          "type": "string"
        },
        "schema": {
          "$ref": "#/definitions/jsonSchema"
        }
      },
      "additionalProperties": false
    },
    "lifecycleConfig": {
      "type": "object",
      "required": ["hooks"],
      "properties": {
        "hooks": {
          "$ref": "#/definitions/lifecycleHooks"
        },
        "dependencies": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "shutdownTimeout": {
          "type": "integer",
          "minimum": 1000,
          "default": 30000
        },
        "healthCheck": {
          "$ref": "#/definitions/healthCheckConfig"
        }
      },
      "additionalProperties": false
    },
    "lifecycleHooks": {
      "type": "object",
      "properties": {
        "beforeLoad": {
          "type": "string"
        },
        "afterLoad": {
          "type": "string"
        },
        "beforeStart": {
          "type": "string"
        },
        "afterStart": {
          "type": "string"
        },
        "beforeStop": {
          "type": "string"
        },
        "afterStop": {
          "type": "string"
        },
        "beforeUnload": {
          "type": "string"
        },
        "afterUnload": {
          "type": "string"
        }
      },
      "additionalProperties": false
    },
    "healthCheckConfig": {
      "type": "object",
      "required": ["enabled"],
      "properties": {
        "enabled": {
          "type": "boolean"
        },
        "interval": {
          "type": "integer",
          "minimum": 1000,
          "default": 30000
        },
        "timeout": {
          "type": "integer",
          "minimum": 1000,
          "default": 5000
        },
        "endpoint": {
          "type": "string"
        }
      },
      "additionalProperties": false
    },
    "buildInfo": {
      "type": "object",
      "required": ["hash", "timestamp", "platform", "node", "environment"],
      "properties": {
        "hash": {
          "type": "string"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time"
        },
        "platform": {
          "type": "string"
        },
        "node": {
          "type": "string"
        },
        "environment": {
          "type": "string"
        }
      },
      "additionalProperties": false
    },
    "certification": {
      "type": "object",
      "required": ["level"],
      "properties": {
        "level": {
          "type": "string",
          "enum": ["community", "verified", "official"]
        },
        "certifiedAt": {
          "type": "string",
          "format": "date-time"
        },
        "certifiedBy": {
          "type": "string"
        },
        "signature": {
          "type": "string"
        }
      },
      "additionalProperties": false
    },
    "telemetryConfig": {
      "type": "object",
      "required": ["enabled"],
      "properties": {
        "enabled": {
          "type": "boolean"
        },
        "endpoint": {
          "type": "string",
          "format": "uri"
        },
        "events": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": false
    },
    "documentation": {
      "type": "object",
      "properties": {
        "readme": {
          "type": "string",
          "format": "uri"
        },
        "api": {
          "type": "string",
          "format": "uri"
        },
        "examples": {
          "type": "string",
          "format": "uri"
        },
        "changelog": {
          "type": "string",
          "format": "uri"
        },
        "migration": {
          "type": "string",
          "format": "uri"
        }
      },
      "additionalProperties": false
    },
    "size": {
      "type": "object",
      "required": ["width", "height"],
      "properties": {
        "width": {
          "type": "integer",
          "minimum": 100
        },
        "height": {
          "type": "integer",
          "minimum": 100
        }
      },
      "additionalProperties": false
    }
  }
}